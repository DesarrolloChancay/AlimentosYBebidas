{% extends "base.html" %} 
{% block title %}Historial de Inspecciones{% endblock %} 
{% block content %}

<section class="min-h-screen p-4 md:p-8">
  <!-- Header -->
  <header class="mb-6">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white">Historial de Inspecciones</h1>
      <p class="text-slate-600 dark:text-slate-400">Busque y revise inspecciones anteriores</p>
    </div>
  </header>

  <!-- Filtros de búsqueda -->
  <div class="bg-white rounded-2xl shadow p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4">Filtros de Búsqueda</h2>
    <form
      id="filtros-form"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
    >
      <!-- Establecimiento -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Establecimiento</label
        >
        <select
          id="filtro-establecimiento"
          name="establecimiento_id"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">Todos los establecimientos</option>
        </select>
      </div>

      <!-- Fecha inicio -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Fecha desde</label
        >
        <input
          type="date"
          id="filtro-fecha-inicio"
          name="fecha_inicio"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Fecha fin -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Fecha hasta</label
        >
        <input
          type="date"
          id="filtro-fecha-fin"
          name="fecha_fin"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Estado -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Estado</label
        >
        <select
          id="filtro-estado"
          name="estado"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">Todos los estados</option>
          <option value="borrador">Borrador</option>
          <option value="en_proceso">En Proceso</option>
          <option value="completada">Completada</option>
        </select>
      </div>

      <!-- Botones -->
      <div class="md:col-span-2 lg:col-span-4 flex gap-3">
        <button
          type="submit"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        >
          Buscar
        </button>
        <button
          type="button"
          id="limpiar-filtros"
          class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
        >
          Limpiar Filtros
        </button>
      </div>
    </form>
  </div>

  <!-- Resultados -->
  <div class="bg-white rounded-2xl shadow">
    <div class="p-6 border-b">
      <h2 class="text-lg font-semibold">Resultados de Búsqueda</h2>
      <p class="text-sm text-gray-600 mt-1">
        Total de inspecciones encontradas: <span id="total-resultados">0</span>
      </p>
    </div>

    <div id="loading" class="flex justify-center items-center py-12 hidden">
      <div
        class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
      ></div>
      <span class="ml-2 text-gray-600">Buscando...</span>
    </div>

    <div id="resultados-container" class="divide-y">
      <!-- Las inspecciones se cargarán aquí -->
    </div>

    <!-- Mensaje cuando no hay resultados -->
    <div id="sin-resultados" class="p-12 text-center text-gray-500 hidden">
      <svg
        class="w-16 h-16 mx-auto mb-4 text-gray-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
        />
      </svg>
      <p class="text-lg font-medium mb-2">No se encontraron inspecciones</p>
      <p>Intente modificar los criterios de búsqueda</p>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/inspecciones.js') }}"></script>
<!-- Agregar rol de usuario para JavaScript -->
<div data-user-role="{{ user_role }}" style="display: none;"></div>
{% endblock %}
